---
layout:  post
title:  《TCP/IP协议详解》读书笔记（七）
date: 2019-06-19 13:32:20 +0300
tags: [计算机网络,读书笔记]
typora-root-url: .
typora-copy-images-to: ..\assets\clipimg
---

# 第19章 TCP的交互数据流

 

**延时ACK：**通常TCP在接收到数据时并不立即发送ACK；相反，它推迟发送，以便将ACK与需要沿该方向发送的数据一起发送（有时称这种现象为数据捎带ACK）。绝大多数实现采用的时延为200ms，也就是说，TCP将以最大200ms的时延等待是否有数据一起发送。

**总结**

交互数据总是以小于最大报文段长度的分组发送。在Rlogin中通常**只有一个字节**从客户发送到服务器。Telnet允许一次发送一行输入数据，但是目前大多数实现仍然发送一个字节。

对于这些小的报文段，接收方使用**经受时延的确认方法**来判断确认是否可被推迟发送，以便与回送数据一起发送。这样通常会减少报文段的数目，尤其是对于需要回显用户输入字符的Rlogin会话。

在较慢的广域网环境中，通常使用**Nagle算法**来减少这些小报文段的数目。这个算法限制发送者任何时候只能有一个发送的小报文段未被确认。但我们给出的一个例子也表明有时需要禁止Nagle算法的功能。

 

# 第20章 TCP的成块数据流

 

TCP中ACK实行累积确认。

滑动窗口协议

**慢启动：**该算法通过观察到新分组进入网络的速率应该与另一端返回确认的速率相同而进行工作。

关于慢启动：收到一个ACK窗口加1，但是在一个RRT时间内窗口大小是呈指数增长的。

 

 

# 第21章 TCP的超时与重传

 

TCP提供可靠的运输层。它使用的方法之一就是**确认**从另一端收到的数据。但数据和确认都有可能会丢失。TCP通过在发送时设置一个**定时器**来解决这种问题。如果当定时器溢出时还没有收到确认，它就重传该数据。对任何实现而言，关键之处就在于超时和重传的策略，即怎样决定超时间隔和如何确定重传的频率。

 

**拥塞避免算法**：对每个连接维持两个变量，一个拥塞窗口cwnd一个慢启动门限ssthresh。工作过程如下：

1. 对于一个给定的连接，初始化cwnd为一个报文段，ssthresh为65535个字节。
2. TCP输出例程的输出不能超过cwnd和接收方通告窗口打下。拥塞避免是发送方使用的流量控制，而通告创库则是接收方进行的流量控制。前者是发送方感受到的网络拥塞的估计，而后者则与接收方在该连接上的可用缓存大小有关。
3. 当拥塞发生时（超时或收到重复确认），ssthresh被设置为当前窗口大小（cwnd和接收方通告窗口大小的最小值，但最少为2个报文段）的一半。此外，如果是超时引起了拥塞，则cwnd被设置为1个报文段（这就是慢启动）。
4. 当新的数据被对方确认时，就增加cwnd，但增加的方法依赖于我们是否正在进行慢启动或拥塞避免。如果cwnd小于或等于ssthresh，则正在进行慢启动，否则正在进行拥塞避免。慢启动一直持续到我们回到当拥塞发生时所处位置的一半时才停止，然后转为执行拥塞避免。

- 慢启动算法初始设置cwnd为1个报文段，此后每收到一个确认就加1。
- 拥塞避免算法要求每次收到一个确认时将cwnd增加1/cwnd。与慢启动的指数增加比起来，这是一种加性增长(additiveincrease)。我们希望在一个往返时间内最多为cwnd增加1个报文段（不管在这个RTT中收到了多少个ACK），然而慢启动将根据这个往返时间中所收到的确认的个数增加cwnd。

 

**快速重传算法：**由于我们不知道一个重复的ACK是由一个丢失的报文段引起的，还是由于仅仅出现了几个报文段的重新排序，因此我们等待少量重复的ACK到来。假如这只是一些报文段的重新排序，则在重新排序的报文段被处理并产生一个新的ACK之前，只可能产生1~2个重复的ACK。如果一连串收到3个或3个以上的重复ACK，就非常可能是一个报文段丢失了（我们在21.5节中见到过这种现象）。于是我们就重传丢失的数据报文段，而无需等待超时定时器溢出。

 

**快速恢复算法：**快速重传后不执行慢启动而执行拥塞避免，也即窗口调整为一半，然后每收到一个ACK窗口增加1/wcnd大小。

 

**带快速恢复的拥塞避免算法：**

1. 当收到第3个重复的ACK时，将ssthresh设置为当前拥塞窗口cwnd的一半。重传丢失的报文段。设置cwnd为ssthresh加上3倍的报文段大小。
2. 每次收到另一个重复的ACK时，cwnd增加1个报文段大小并发送1个分组（如果新的cwnd允许发送）。
3. 当下一个确认新数据的ACK到达时，设置cwnd为ssthresh（在第1步中设置的值）。这个ACK应该是在进行重传后的一个往返时间内对步骤1中重传的确认。另外，这个ACK也应该是对丢失的分组和收到的第1个重复的ACK之间的所有中间报文段的确认。这一步采用的是拥塞避免，因为当分组丢失时我们将当前的速率减半。

